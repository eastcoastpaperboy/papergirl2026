<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Papergirl 2026 - City Select</title>
<style>

    @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
    * { margin:0; padding:0; box-sizing:border-box; }
    html, body { width:100%; height:100%; overflow:hidden; background:#000; }

    .screen { position:absolute; inset:0; width:100%; height:100%; display:none; }
    .screen.active { display:block; }

    #start-screen { cursor:pointer; overflow:hidden; background:#01a6e0; }
    #start-screen img { width:100%; height:100%; object-fit:cover; object-position:top center; display:block; }
    #start-overlay {
      position:absolute; bottom:0; left:0; right:0;
      padding:32px 20px 30px;
      background:linear-gradient(transparent, rgba(0,0,0,0.88));
      display:flex; flex-direction:column; align-items:center; gap:18px;
    }
    #start-row { display:flex; align-items:center; gap:20px; line-height:1; }
    #press-start {
      font-family:'Press Start 2P',monospace;
      font-size:clamp(14px,2.2vw,26px);
      letter-spacing:4px; display:inline-block;
    }
    #press-start .char {
      display:inline-block; color:#fff;
      text-shadow:3px 3px 0 #000;
      animation:wave 1.4s ease-in-out infinite;
    }
    @keyframes wave {
      0%,100% { transform:translateY(0);    color:#fff; }
      50%      { transform:translateY(-9px); color:#ffe066; }
    }
    .arrow {
      font-family:'Press Start 2P',monospace;
      font-size:clamp(14px,2.2vw,26px);
      color:#ffe066; text-shadow:2px 2px 0 #000;
      display:block;
      line-height:1;
    }
    .arrow-left  { animation:nudge-left  0.65s ease-in-out infinite alternate; }
    .arrow-right { animation:nudge-right 0.65s ease-in-out infinite alternate; }
    @keyframes nudge-left  { from { transform:translateX(0); opacity:.5; } to { transform:translateX(-7px); opacity:1; } }
    @keyframes nudge-right { from { transform:translateX(0); opacity:.5; } to { transform:translateX( 7px); opacity:1; } }
    #instructions {
      font-family:'Press Start 2P',monospace;
      font-size:clamp(7px,0.9vw,10px); color:#ffe066;
      text-shadow:1px 1px 0 #000; text-align:center;
      line-height:2.4; letter-spacing:1px;
      opacity:0; animation:fade-in 2s ease 0.5s forwards;
    }
    @keyframes fade-in { from { opacity:0; transform:translateY(8px); } to { opacity:1; transform:translateY(0); } }

    #city-screen { background:#0096c7; font-family:'Press Start 2P',monospace; }
    #city-wrapper {
      width:100vw; height:100vh;
      display:flex; flex-direction:column;
      justify-content:center; padding-left:12vw; gap:20px;
    }
    #city-wrapper h1 { font-size:13px; color:#ffe066; letter-spacing:3px; margin-bottom:24px; }
    .city { font-size:20px; letter-spacing:2px; padding:4px 0; display:flex; align-items:center; gap:16px; }
    .city.unlocked { color:#fff; cursor:pointer; }
    .city.unlocked:hover { color:#ffe066; }
    .city.locked { color:#a8d8ea; cursor:default; }
    .coming-soon { font-size:8px; color:#a8d8ea; letter-spacing:1px; }
    .city-arrow { font-size:18px; color:#ffe066; animation:blink 0.7s step-end infinite; display:inline-block; width:24px; }
    .city.locked .city-arrow { visibility:hidden; }
    @keyframes blink { 0%,100% { opacity:1; } 50% { opacity:0; } }
    #back { margin-top:40px; font-size:9px; color:rgba(255,255,255,0.4); cursor:pointer; letter-spacing:2px; }
    #back:hover { color:#ffe066; }
  
</style>
</head>
<body>
<div id="city-screen" class="screen active">
    <div id="city-wrapper">
      <h1>SELECT CITY</h1>
      <div class="city unlocked" onclick="window.location='houston.html'">
        <span class="city-arrow">&#9654;</span>
        HOUSTON, TX
      </div>
      <div class="city locked">
        <span class="city-arrow">&#9654;</span>
        MINNEAPOLIS, MN &nbsp;<span class="coming-soon">COMING SOON</span>
      </div>
      <div class="city locked">
        <span class="city-arrow">&#9654;</span>
        LOS ANGELES, CA &nbsp;<span class="coming-soon">COMING SOON</span>
      </div>
    </div>
  </div>
<script>

  // ═══════════════════════════════════════════════════════
  // AUDIO CONTEXT
  // ═══════════════════════════════════════════════════════
  let AC = null;
  function getAC() {
    if (!AC) AC = new (window.AudioContext || window.webkitAudioContext)();
    if (AC.state === 'suspended') AC.resume();
    return AC;
  }

  // ── Start jingle ──
  function playStartJingle() {
    const ac = getAC();
    const t  = ac.currentTime;
    [[659,0.00,0.08],[784,0.08,0.08],[988,0.16,0.14]].forEach(([f,o,d]) => {
      const osc = ac.createOscillator(), g = ac.createGain();
      osc.type = 'square';
      osc.frequency.setValueAtTime(f, t+o);
      g.gain.setValueAtTime(0.18, t+o);
      g.gain.linearRampToValueAtTime(0, t+o+d);
      osc.connect(g); g.connect(ac.destination);
      osc.start(t+o); osc.stop(t+o+d+0.01);
    });
  }

  // ── Select blip ──
  function playSelectBlip() {
    const ac = getAC(), t = ac.currentTime;
    const osc = ac.createOscillator(), g = ac.createGain();
    osc.type = 'square';
    osc.frequency.setValueAtTime(523, t);
    osc.frequency.setValueAtTime(659, t+0.05);
    g.gain.setValueAtTime(0.15, t);
    g.gain.linearRampToValueAtTime(0, t+0.12);
    osc.connect(g); g.connect(ac.destination);
    osc.start(t); osc.stop(t+0.15);
  }

  // ═══════════════════════════════════════════════════════
  // SEAMLESS LOOPING CHIPTUNE
  // Key technique: schedule notes using ac.currentTime
  // (the audio clock) not setTimeout. We pre-schedule the
  // NEXT loop before the current one finishes so there is
  // zero gap between iterations.
  // ═══════════════════════════════════════════════════════
  const BPM      = 160;
  const BEAT     = 60 / BPM;
  const E        = BEAT / 2;   // eighth note, in seconds
  const LOOP_LEN = 32 * E;     // total loop length in seconds — exact

  let musicPlaying  = false;
  let nextLoopTime  = 0;        // audio-clock time for next loop start
  let scheduleTimer = null;     // setTimeout handle for the scheduler

  // Note table
  const N = {
    C3:130.81,D3:146.83,E3:164.81,F3:174.61,G3:196.00,A3:220.00,
    C4:261.63,D4:293.66,E4:329.63,F4:349.23,G4:392.00,A4:440.00,B4:493.88,
    C5:523.25,D5:587.33,E5:659.25,G5:783.99,Fs4:369.99,Fs3:184.99
  };

  function note(type, freq, start, dur, vol) {
    const ac  = getAC();
    const osc = ac.createOscillator();
    const g   = ac.createGain();
    osc.type = type;
    osc.frequency.setValueAtTime(freq, start);
    if (type === 'square') {
      g.gain.setValueAtTime(0, start);
      g.gain.linearRampToValueAtTime(vol, start + 0.005);
      g.gain.setValueAtTime(vol, start + dur - 0.015);
      g.gain.linearRampToValueAtTime(0, start + dur);
    } else {
      g.gain.setValueAtTime(vol, start);
      g.gain.setValueAtTime(vol, start + dur - 0.015);
      g.gain.linearRampToValueAtTime(0, start + dur);
    }
    osc.connect(g); g.connect(ac.destination);
    osc.start(start);
    osc.stop(start + dur + 0.005);
  }

  function scheduleOneLoop(t) {
    // ── Melody (square) ──
    [
      [N.C5,0],[N.E5,1],[N.G5,2],[N.E5,3],[N.C5,4],[N.G4,5],[N.A4,6],[N.B4,7],
      [N.C5,8],[N.D5,9],[N.E5,10],[N.G5,11],[N.G5,12],[N.E5,13],[N.D5,14],[N.C5,15],
      [N.A4,16],[N.B4,17],[N.C5,18],[N.A4,19],[N.G4,20],[N.A4,21],[N.B4,22],[N.C5,23],
      [N.D5,24],[N.E5,25],[N.Fs4,26],[N.G4,27],[N.A4,28],[N.G4,29],[N.E4,30],[N.C4,31],
    ].forEach(([f,i]) => note('square', f, t + i*E, E*0.88, 0.10));

    // ── Harmony (square) ──
    [
      [N.E4,0,2],[N.G4,2,2],[N.F4,4,2],[N.E4,6,2],
      [N.E4,8,2],[N.G4,10,2],[N.G4,12,2],[N.C4,14,2],
      [N.D4,16,2],[N.E4,18,2],[N.D4,20,2],[N.E4,22,2],
      [N.G4,24,2],[N.A4,26,2],[N.G4,28,2],[N.E4,30,2],
    ].forEach(([f,i,len]) => note('square', f, t + i*E, len*E*0.85, 0.06));

    // ── Bass (triangle) ──
    [
      [N.C3,0],[N.C3,2],[N.G3,4],[N.G3,6],
      [N.C3,8],[N.C3,10],[N.G3,12],[N.F3,14],
      [N.A3,16],[N.A3,18],[N.E3,20],[N.E3,22],
      [N.F3,24],[N.F3,26],[N.G3,28],[N.C3,30],
    ].forEach(([f,i]) => note('triangle', f, t + i*E, BEAT*0.82, 0.09));
  }

  // The scheduler runs every 100ms and looks ahead 0.3s
  // If the next loop start is within the look-ahead window, schedule it now
  const LOOKAHEAD = 0.3; // seconds

  function scheduler() {
    if (!musicPlaying) return;
    const ac = getAC();
    while (nextLoopTime < ac.currentTime + LOOKAHEAD) {
      scheduleOneLoop(nextLoopTime);
      nextLoopTime += LOOP_LEN;
    }
    scheduleTimer = setTimeout(scheduler, 100);
  }

  function startMusic() {
    if (musicPlaying) return;
    musicPlaying = true;
    const ac = getAC();
    nextLoopTime = ac.currentTime + 0.05; // tiny lead-in
    scheduler();
  }

  function stopMusic() {
    musicPlaying = false;
    clearTimeout(scheduleTimer);
  }

  // ═══════════════════════════════════════════════════════
  // WAVE LETTERS + NAVIGATION
  // ═══════════════════════════════════════════════════════
  [...'PRESS  START'].forEach((ch, i) => {
    const span = document.createElement('span');
    span.className = 'char';
    span.textContent = ch === ' ' ? '\u00a0' : ch;
    span.style.animationDelay = (i * 0.07) + 's';
    document.getElementById('press-start').appendChild(span);
  });

  function showScreen(id) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
  }

  function goToCity() {
    playStartJingle();
    setTimeout(() => { showScreen('city-screen'); startMusic(); }, 350);
  }

  function goToStart() {
    stopMusic();
    showScreen('start-screen');
  }

  function goToGame() {
    playSelectBlip();
    stopMusic();
    setTimeout(() => { window.location.href = 'houston.html'; }, 400);
  }

  document.addEventListener('keydown', e => {
    if (e.key === 'Escape') goToStart();
    if (e.key === 'Enter' && document.getElementById('city-screen').classList.contains('active')) goToGame();
  });
  
</script>
</body>
</html>